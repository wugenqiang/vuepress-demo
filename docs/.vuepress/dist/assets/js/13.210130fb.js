(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{336:function(t,s,a){"use strict";a.r(s);var n=a(33),r=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"ã€è¯‘ã€‘ä¿æŠ¤æ‚¨çš„graphql-apiå…å—æ¶æ„æŸ¥è¯¢çš„å½±å“"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ã€è¯‘ã€‘ä¿æŠ¤æ‚¨çš„graphql-apiå…å—æ¶æ„æŸ¥è¯¢çš„å½±å“"}},[t._v("#")]),t._v(" ã€è¯‘ã€‘ä¿æŠ¤æ‚¨çš„GraphQL APIå…å—æ¶æ„æŸ¥è¯¢çš„å½±å“")]),t._v(" "),a("blockquote",[a("p",[t._v("åŸæ–‡åœ°å€ï¼š"),a("a",{attrs:{href:"https://blog.apollographql.com/securing-your-graphql-api-from-malicious-queries-16130a324a6b",target:"_blank",rel:"noopener noreferrer"}},[t._v("Securing Your GraphQL API from Malicious Queries â€“ Apollo GraphQL"),a("OutboundLink")],1)])]),t._v(" "),a("blockquote",[a("p",[t._v("Max Stoiberæ˜¯Spectrumçš„CTOï¼Œè¿™æ˜¯ä¸€ä¸ªé¢å‘åœ¨çº¿ç¤¾åŒºçš„å®æ—¶èŠå¤©å¹³å°ã€‚\nåœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œä»–è®²è¿°äº†ä»–ä»¬å¦‚ä½•ä¿æŠ¤GraphQL APIå…å—æ”»å‡»ã€‚")])]),t._v(" "),a("p",[t._v("ä½¿ç”¨GraphQLï¼Œæ‚¨å¯ä»¥éšæ—¶æŸ¥è¯¢æ‚¨æƒ³è¦çš„å†…å®¹ã€‚è¿™å¯ä»¥è®©æˆ‘ä»¬å¾ˆæ–¹ä¾¿åœ°ä½¿ç”¨APIâ€‹â€‹ï¼Œä½†ä¹Ÿå…·æœ‰å¤æ‚çš„å®‰å…¨éšæ‚£ã€‚ä¸æ€€å¥½æ„çš„äººå¯ä»¥ä¸å»è¯·æ±‚åˆæ³•ï¼Œæœ‰ç”¨çš„æ•°æ®ï¼Œè€Œæ˜¯æäº¤å¤æ‚çš„åµŒå¥—æŸ¥è¯¢æ¥è®©æ‚¨çš„æœåŠ¡å™¨ã€æ•°æ®åº“ã€ç½‘ç»œæˆ–æ‰€æœ‰è¿™äº›æ•°æ®è¿‡åˆ†è´Ÿè½½ã€‚å¦‚æœæ²¡æœ‰æ­£ç¡®çš„ä¿æŠ¤æªæ–½ï¼Œæ‚¨å¯èƒ½ä¼šè®©è‡ªå·±æš´éœ²åœ¨DoSï¼ˆæ‹’ç»æœåŠ¡ï¼‰æ”»å‡»ä¹‹ä¸‹ã€‚")]),t._v(" "),a("p",[t._v("ä¾‹å¦‚ï¼Œåœ¨Spectrumçš„GraphQL APIä¸­ï¼Œæˆ‘ä»¬æœ‰è¿™æ ·çš„å…³ç³»ï¼š")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("type Thread "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("messages")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("first"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Int"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" after"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" String"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("Message"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\ntype Message "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  thread"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Thread\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\ntype Query "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("thread")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("id"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("ID")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Thread\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("å¦‚æ‚¨æ‰€è§ï¼Œæ‚¨å¯ä»¥æŸ¥è¯¢Threadçš„messagesæˆ–Messageçš„threadã€‚è¿™ç§å¾ªç¯å…³ç³»ç»™ä¸€ä¸ªä¸æ€€å¥½æ„çš„äººå¯ä¹˜ä¹‹æœºæ¥æ„é€ ä¸€ä¸ªå¤æ‚çš„åµŒå¥—æŸ¥è¯¢ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("query maliciousQuery "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("thread")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("id"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"some-id"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("messages")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("first"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("99999")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      thread "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("messages")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("first"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("99999")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          thread "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("messages")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("first"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("99999")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n              thread "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                # "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("repeat times "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10000.")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n              "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("è¿™ç§æŸ¥è¯¢å¦‚æœçœŸçš„è¿è¡Œèµ·æ¥æ˜¯éå¸¸ç³Ÿç³•çš„ï¼Œå› ä¸ºå®ƒä¼šä»¥æŒ‡æ•°æ–¹å¼å¢åŠ åŠ è½½çš„å¯¹è±¡æ•°é‡ï¼Œå¹¶ä¼šä½¿æ•´ä¸ªæœåŠ¡å™¨å´©æºƒã€‚è™½ç„¶åœ¨å…¶ä»–å±‚æœ‰æŸäº›ç¼“è§£æªæ–½ä½¿å¾—å‘é€æŸ¥è¯¢éƒ½æ²¡æœ‰é‚£ä¹ˆç®€å•ï¼ˆä¾‹å¦‚CORSï¼‰ï¼Œä½†å®ƒä»¬ä¹Ÿæ— æ³•å®Œå…¨é˜»æ­¢è¿™ç§æŸ¥è¯¢å‘ç”Ÿã€‚")]),t._v(" "),a("h2",{attrs:{id:"å¤§å°é™åˆ¶"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#å¤§å°é™åˆ¶"}},[t._v("#")]),t._v(" å¤§å°é™åˆ¶")]),t._v(" "),a("p",[t._v("æˆ‘ä»¬æƒ³åˆ°çš„ç¬¬ä¸€ä¸ªå¤©çœŸçš„æ–¹æ³•æ˜¯é€šè¿‡åŸå§‹å­—èŠ‚é™åˆ¶ä¼ å…¥çš„æŸ¥è¯¢å¤§å°ã€‚ç”±äºæŸ¥è¯¢æ˜¯ä½œä¸ºå­—ç¬¦ä¸²å‘é€çš„ï¼Œå› æ­¤ä¸€ä¸ªç®€å•çš„å­—èŠ‚æ£€æŸ¥å°±è¶³å¤Ÿäº†ï¼š")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("use")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'*'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("req"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" res"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" next")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" query "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" req"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("query"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("query "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" req"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("body"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("query "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("''")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("query"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("length "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2000")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("throw")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Error")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Query too large'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("next")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("é—æ†¾çš„æ˜¯ï¼Œè¿™åœ¨çœŸå®åœºæ™¯ä¸­æ•ˆæœä¸ä½³ï¼šè¿™ç§ç®€å•çš„æ£€æŸ¥æ— æ³•é˜»æ­¢ä¸æ€€å¥½æ„çš„äººä½¿ç”¨çŸ­å­—æ®µåç§°è¿›è¡Œæ¶æ„æŸ¥è¯¢ï¼Œä¹Ÿä¼šé™åˆ¶ä½é‚£ç§ä½¿ç”¨é•¿å­—æ®µåç§°æˆ–åµŒå¥—ç‰‡æ®µæ¥åšçš„åˆæ³•æŸ¥è¯¢ã€‚")]),t._v(" "),a("h2",{attrs:{id:"æŸ¥è¯¢ç™½åå•"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#æŸ¥è¯¢ç™½åå•"}},[t._v("#")]),t._v(" æŸ¥è¯¢ç™½åå•")]),t._v(" "),a("p",[t._v("æˆ‘ä»¬è€ƒè™‘çš„ç¬¬äºŒç§æ–¹æ³•æ˜¯åœ¨æˆ‘ä»¬è‡ªå·±çš„åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨å·²æ‰¹å‡†çš„æŸ¥è¯¢ç™½åå•ï¼Œå¹¶å‘Šè¯‰æœåŠ¡å™¨åªè®©ç™½åå•ä¸Šçš„æŸ¥è¯¢é€šè¿‡ã€‚")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("use")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/api'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("graphqlServer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("req"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" res")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" query "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" req"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("query"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("query "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" req"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("body"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("query"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// TODO: Get whitelist somehow")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("whitelist"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("query"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("throw")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Error")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Query is not in whitelist.'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/* ... */")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("æ‰‹åŠ¨ç»´æŠ¤æŸ¥è¯¢ç™½åå•æ˜¾ç„¶ä¼šå¾ˆéº»çƒ¦ï¼Œä½†å¹¸å¥½Apolloå›¢é˜Ÿåˆ›å»ºäº†persistgraphqlï¼Œå®ƒè‡ªåŠ¨ä»å®¢æˆ·ç«¯ä»£ç ä¸­æå–æ‰€æœ‰æŸ¥è¯¢å¹¶ä»ä¸­ç”Ÿæˆä¸€ä¸ªä¸é”™çš„JSONæ–‡ä»¶ã€‚")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"scripts"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"postbuild"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"persistgraphql src api/query-whitelist.json"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("è¿™ç§æŠ€æœ¯éå¸¸æœ‰æ•ˆï¼Œå¯ä»¥å¯é åœ°é˜»æ­¢æ‰€æœ‰æ¶æ„æŸ¥è¯¢ã€‚ä¸å¹¸çš„æ˜¯ï¼Œå®ƒè¿˜æœ‰ä¸¤ä¸ªä¸»è¦çš„çŸ­æ¿ï¼š")]),t._v(" "),a("ul",[a("li",[t._v("æˆ‘ä»¬æ°¸è¿œä¸èƒ½æ›´æ”¹æˆ–åˆ é™¤æŸ¥è¯¢ï¼Œåªèƒ½æ·»åŠ æ–°æŸ¥è¯¢ï¼šå¦‚æœä»»ä½•ç”¨æˆ·æ­£åœ¨è¿è¡Œè¿‡æ—¶çš„å®¢æˆ·ç«¯ï¼Œæˆ‘ä»¬ä¸èƒ½é˜»æ­¢ä»–ä»¬çš„è¯·æ±‚ã€‚æˆ‘ä»¬å¯èƒ½ä¸å¾—ä¸ä¿ç•™æ‰€æœ‰åœ¨ç”Ÿäº§ä¸­ä½¿ç”¨çš„æŸ¥è¯¢çš„å†å²è®°å½•ã€‚")]),t._v(" "),a("li",[t._v("æˆ‘ä»¬æ— æ³•å‘å…¬ä¼—å¼€æ”¾æˆ‘ä»¬çš„APIï¼šæœªæ¥çš„æŸä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬å¸Œæœ›å‘å…¬ä¼—å¼€æ”¾æˆ‘ä»¬çš„APIï¼Œä»¥ä¾¿å…¶ä»–å¼€å‘äººå‘˜å¯ä»¥å‚ä¸åˆ°å¯¹Spectrumç•Œé¢çš„æ„å»ºä¸­æ¥ã€‚æŸ¥è¯¢ç™½åå•ä¸¥é‡é™åˆ¶ä»–ä»¬çš„æŸ¥è¯¢è‡ªç”±å¹¶ä¸”å¤±å»äº†ä½¿ç”¨GraphQL APIçš„åˆè¡·ã€‚")])]),t._v(" "),a("p",[t._v("ä»¥ä¸Šæ˜¯æˆ‘ä»¬æ— æ³•è§£å†³çš„é™åˆ¶å› ç´ ï¼Œæ‰€ä»¥æˆ‘ä»¬åªèƒ½å›åˆ°åŸç‚¹ã€‚")]),t._v(" "),a("h2",{attrs:{id:"ï¼ˆæŸ¥è¯¢ï¼‰æ·±åº¦é™åˆ¶"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ï¼ˆæŸ¥è¯¢ï¼‰æ·±åº¦é™åˆ¶"}},[t._v("#")]),t._v(" ï¼ˆæŸ¥è¯¢ï¼‰æ·±åº¦é™åˆ¶")]),t._v(" "),a("p",[t._v("ä¸Šé¢çš„æ¶æ„æŸ¥è¯¢çš„ä¸€ä¸ªæœ‰å®³æ–¹é¢æ˜¯åµŒå¥—ï¼ŒæŒ‰å…¶æ·±åº¦åˆ†ç±»ï¼Œè¿™ä½¿å¾—æŸ¥è¯¢çš„ä»£ä»·æ›´åŠ æ˜‚è´µã€‚æ¯ä¸€å±‚æŸ¥è¯¢éƒ½ä¸ºåç«¯æ·»åŠ äº†æ›´å¤šå·¥ä½œï¼Œä¸åˆ—è¡¨ç»“åˆä½¿ç”¨æ—¶å¯ä»¥å¿«é€Ÿæ·»åŠ ã€‚")]),t._v(" "),a("p",[t._v("æˆ‘ä»¬è°ƒç ”äº†ä¸€äº›å·¥å…·ï¼Œæ‰¾åˆ°äº†graphql-depth-limitï¼Œä¸€ä¸ªç”±Andrew Carlsonè®¾è®¡çš„å¯çˆ±æ¨¡å—ï¼Œå®ƒä½¿æˆ‘ä»¬èƒ½å¤Ÿè½»æ¾é™åˆ¶ä¼ å…¥æŸ¥è¯¢çš„æœ€å¤§æ·±åº¦ã€‚æˆ‘ä»¬æ£€æŸ¥äº†æˆ‘ä»¬çš„å®¢æˆ·ç«¯ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„æœ€æ·±å±‚æŸ¥è¯¢æœ‰7å±‚ï¼Œæ‰€ä»¥æˆ‘ä»¬é€‰æ‹©äº†ï¼ˆéå¸¸å®½æ¾ï¼‰æœ€å¤§æ·±åº¦10å¹¶å°†å…¶æ·»åŠ åˆ°æˆ‘ä»¬çš„éªŒè¯è§„åˆ™ä¸­ï¼š")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("use")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/api'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("graphqlServer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  validationRules"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("depthLimit")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("è¿™æ ·å°±å¯ä»¥éå¸¸ç®€å•åœ°é™åˆ¶ä½æŸ¥è¯¢æ·±åº¦ã€‚")]),t._v(" "),a("h2",{attrs:{id:"ï¼ˆæŸ¥è¯¢ï¼‰æ•°é‡é™åˆ¶"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ï¼ˆæŸ¥è¯¢ï¼‰æ•°é‡é™åˆ¶"}},[t._v("#")]),t._v(" ï¼ˆæŸ¥è¯¢ï¼‰æ•°é‡é™åˆ¶")]),t._v(" "),a("p",[t._v("ä¸Šè¿°æ¶æ„æŸ¥è¯¢çš„ç¬¬äºŒä¸ªé£é™©ç‚¹æ˜¯è·å–99999ä¸ªå¯¹è±¡ã€‚æ— è®ºé‚£ä¸ªå¯¹è±¡æ˜¯ä»€ä¹ˆï¼ŒæŸ¥è¯¢æ•°é‡è¿™ä¹ˆå¤§ï¼ŒæŸ¥è¯¢ä»£ä»·æ€»æ˜¯å¾ˆæ˜‚è´µçš„ã€‚ï¼ˆå°½ç®¡DataLoaderå¯èƒ½ä¼šå‡è½»æ•°æ®åº“å‹åŠ›ï¼Œä½†ä¸ä¼šå‡è½»ç½‘ç»œå’Œå¤„ç†çš„å‹åŠ›ï¼‰")]),t._v(" "),a("p",[t._v("æˆ‘æ²¡æœ‰å°†ç¬¬ä¸€ä¸ªå‚æ•°çš„ç±»å‹è®¾ç½®ä¸ºIntï¼ˆå…è®¸ä»»æ„æ•°å­—ï¼‰ï¼Œè€Œæ˜¯ä½¿ç”¨graphql-input-numberåˆ›å»ºè‡ªå®šä¹‰æ ‡é‡ï¼Œå°†æœ€å¤§å€¼é™åˆ¶ä¸º100ï¼š")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" PaginationAmount "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("GraphQLInputInt")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  name"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'PaginationAmount'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  min"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  max"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("p",[t._v("å¦‚æœæœ‰äººæŸ¥è¯¢è¶…è¿‡100ä¸ªå¯¹è±¡ï¼Œè¿™å°†æŠ›å‡ºé”™è¯¯ã€‚ç„¶åæˆ‘ä»¬å°±å¯ä»¥åœ¨ä»»ä½•ç›¸å…³çš„APIä¸­ä½¿ç”¨å®ƒï¼š")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("type Thread "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("messages")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("first"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" PaginationAmount"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" after"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" String"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("Message"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("ç°åœ¨æˆ‘ä»¬å®Œå…¨é˜»æ­¢äº†ä¸Šé¢çš„æ¶æ„æŸ¥è¯¢ï¼ğŸ‰")]),t._v(" "),a("h2",{attrs:{id:"æŸ¥è¯¢æˆæœ¬åˆ†æ"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#æŸ¥è¯¢æˆæœ¬åˆ†æ"}},[t._v("#")]),t._v(" æŸ¥è¯¢æˆæœ¬åˆ†æ")]),t._v(" "),a("p",[t._v("ä¸å¹¸çš„æ˜¯ï¼Œåœ¨é€‚å½“çš„æ¡ä»¶ä¸‹ä»æœ‰å¯èƒ½è®©æœåŠ¡å™¨ä¸å ªé‡è´Ÿï¼šæŸäº›ç‰¹å®šäºåº”ç”¨ç¨‹åºçš„æŸ¥è¯¢æ—¢ä¸å¤ªæ·±ä¹Ÿä¸ä¼šè¯·æ±‚å¤ªå¤šçš„å¯¹è±¡ï¼Œä½†æŸ¥è¯¢ä»£ä»·ä»ç„¶éå¸¸æ˜‚è´µã€‚å¯¹äºæˆ‘ä»¬Spectrumï¼Œè¿™æ ·çš„æŸ¥è¯¢å¯èƒ½å¦‚ä¸‹æ‰€ç¤ºï¼š")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("query evilQuery "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("thread")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("id"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"54887141-57a9-4386-807c-ed950c4d5132"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("messageConnection")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("first"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("participants")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("first"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("threadConnection")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("first"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      communityConnection "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      channelConnection "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("everything")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("first"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("åœ¨æ­¤æŸ¥è¯¢ä¸­ï¼ŒæŸ¥è¯¢æ·±åº¦å’ŒæŸ¥è¯¢æ•°é‡éƒ½ä¸æ˜¯ç‰¹åˆ«å¤§ï¼Œå› æ­¤å®ƒå°†é€šè¿‡æˆ‘ä»¬å½“å‰çš„é™åˆ¶ã€‚ç„¶è€Œï¼Œå®ƒå¯èƒ½ä¼šè·å–æ•°ä»¥ä¸‡è®¡çš„è®°å½•ï¼Œè¿™æ„å‘³ç€å®ƒåœ¨æ•°æ®åº“ï¼ŒæœåŠ¡å™¨å’Œç½‘ç»œä¸Šæ˜¯å¯†é›†çš„ï¼Œè¿™æ˜¯æœ€ç³Ÿç³•çš„æƒ…å†µã€‚")]),t._v(" "),a("p",[t._v("ä¸ºäº†é˜²æ­¢è¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬éœ€è¦åœ¨è¿è¡Œå®ƒä»¬ä¹‹å‰åˆ†ææŸ¥è¯¢ä»¥è®¡ç®—å®ƒä»¬çš„å¤æ‚æ€§å¹¶åœ¨è¿‡äºæ˜‚è´µæ—¶é˜»æ­¢å®ƒä»¬ã€‚è™½ç„¶è¿™æ¯”æˆ‘ä»¬ä¹‹å‰çš„ä¸¤ä¸ªä¿æŠ¤å·¥ä½œéƒ½è¦å¤šï¼Œä½†å®ƒä¼š100ï¼…ç¡®å®šæ²¡æœ‰æ¶æ„æŸ¥è¯¢å¯ä»¥åˆ°è¾¾æˆ‘ä»¬çš„è§£æå™¨ã€‚")]),t._v(" "),a("p",[a("strong",[t._v("åœ¨å¼€å§‹ä¹‹å‰èŠ±è´¹å¤§é‡æ—¶é—´å®ç°æŸ¥è¯¢æˆæœ¬åˆ†æï¼Œç¡®ä¿æ‚¨éœ€è¦å®ƒã€‚")]),t._v("\nå°è¯•ä½¿ç”¨æ¶æ„æŸ¥è¯¢æ¥å´©æºƒæˆ–å‡æ…¢æ‚¨çš„APIï¼Œå¹¶æŸ¥çœ‹è¿™äº›ä¼šå¯¹æ‚¨çš„æŸ¥è¯¢æœ‰å¤šå°‘å±å®³â€”â€”ä¹Ÿè®¸æ‚¨çš„APIæ²¡æœ‰è¿™äº›åµŒå¥—å…³ç³»ï¼Œæˆ–è€…å®ƒå¯ä»¥å¤„ç†ä¸€æ¬¡æŠ“å–æ•°åƒæ¡è®°å½•å®Œå…¨æ­£å¸¸å¹¶ä¸”ä¸éœ€è¦æŸ¥è¯¢æˆæœ¬åˆ†æï¼")]),t._v(" "),a("p",[t._v("æˆ‘åœ¨æˆ‘çš„maxed-out 2017 MacBook Proä¸Šæœ¬åœ°è¿è¡Œäº†ä¸Šè¿°æŸ¥è¯¢ï¼Œæˆ‘â€‹â€‹ä»¬çš„APIæœåŠ¡å™¨èŠ±è´¹äº†10-15ç§’æ¥å“åº”ä¸€å…†å­—èŠ‚çš„JSONã€‚ï¼ˆæ‰€ä»¥ï¼‰æˆ‘ä»¬çœŸçš„éœ€è¦å®ƒï¼Œå› ä¸ºæˆ‘ä»¬ä»ä¸å¸Œæœ›ä»»ä½•äººç”¨å®ƒè½°ç‚¸æˆ‘ä»¬çš„APIã€‚ï¼ˆGitHub GraphQL APIä¹Ÿä½¿ç”¨æŸ¥è¯¢æˆæœ¬åˆ†æï¼‰")]),t._v(" "),a("h2",{attrs:{id:"å®æ–½æŸ¥è¯¢æˆæœ¬åˆ†æ"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#å®æ–½æŸ¥è¯¢æˆæœ¬åˆ†æ"}},[t._v("#")]),t._v(" å®æ–½æŸ¥è¯¢æˆæœ¬åˆ†æ")]),t._v(" "),a("p",[t._v("åœ¨npmä¸Šæœ‰å‡ ä¸ªåŒ…æ¥å®ç°æŸ¥è¯¢æˆæœ¬åˆ†æã€‚\næˆ‘ä»¬ç”¨è¿‡çš„ä¸¤ä¸ªæ˜¯graphql-validation-complexityâ€”â€”ä¸€ä¸ªå³æ’å³ç”¨æ¨¡å—å’Œgraphql-cost-analysisï¼Œå®ƒé€šè¿‡è®©ä½ æŒ‡å®š@costæŒ‡ä»¤ä¸ºä½ æä¾›æ›´å¤šæ§åˆ¶ã€‚è¿˜æœ‰graphql-query-complexityï¼Œä½†æ˜¯ç›¸æ¯”äºè¿™ä¸ªï¼Œæˆ‘æ›´æ¨ègraphql-cost-analysisï¼Œå› ä¸ºè¿™ä¸¤è€…çš„å·¥ä½œåŸç†æ˜¯ç›¸åŒçš„ï¼Œä½†æ˜¯graphql-query-complexity æ²¡æœ‰æŒ‡ä»¤æˆ–multiplierã€‚")]),t._v(" "),a("p",[t._v("æˆ‘ä»¬ä½¿ç”¨graphql-cost-analysisï¼Œå› ä¸ºæˆ‘ä»¬åœ¨æœ€å¿«çš„è§£æå™¨ï¼ˆ20Î¼sï¼‰å’Œæœ€æ…¢çš„è§£æå™¨ï¼ˆ10s +ï¼‰ä¹‹é—´å­˜åœ¨å¾ˆå¤§çš„å·®å¼‚ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä»ä¸­è·å¾—æ§åˆ¶ã€‚è¯è™½è¿™ä¹ˆè¯´ï¼Œä¹Ÿè®¸graphql-validation-complexityå¯¹ä½ æ¥è¯´å·²ç»è¶³å¤Ÿäº†ï¼Œä¸€å®šè¦è¯•ä¸€è¯•ï¼")]),t._v(" "),a("p",[t._v("å®ƒçš„å·¥ä½œæ–¹å¼æ˜¯æŒ‡å®šè§£ææŸä¸ªå­—æ®µæˆ–ç±»å‹çš„ç›¸å¯¹æˆæœ¬ã€‚å®ƒè¿˜å…·æœ‰multiplicationæ”¯æŒï¼Œå› æ­¤å¦‚æœæ‚¨è¯·æ±‚å¸¦æœ‰ä»»ä½•åµŒå¥—å­—æ®µçš„åˆ—è¡¨éƒ½å°†ä¹˜ä»¥åˆ†é¡µé‡ï¼Œè¿™éå¸¸ç®€æ´ã€‚")]),t._v(" "),a("p",[t._v("è¿™å°±æ˜¯@costæŒ‡ä»¤åœ¨å®è·µä¸­çš„æ ·å­ï¼š")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("type Participant "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  # The complexity "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("of")]),t._v(" getting one thread "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" a thread connection is "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" and multiply that by the amount "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("of")]),t._v(" threads fetched\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("threadConnection")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("first"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" PaginationAmount"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" after"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" String"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" ThreadConnection @"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("cost")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("complexity"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" multipliers"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"first"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\ntype Thread "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  author"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Author @"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("cost")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("complexity"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("participants")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("first"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" PaginationAmount"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("Participant"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" @"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("cost")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("complexity"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" multipliers"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"first"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("è¿™åªæ˜¯æˆ‘ä»¬çš„APIç±»å‹çš„ä¸€å°éƒ¨åˆ†ï¼Œä½†æ‚¨å¯ä»¥çœ‹æ‡‚äº†ã€‚æ‚¨å¯ä»¥æŒ‡å®šæŸä¸ªå­—æ®µçš„å¤æ‚ç¨‹åº¦ï¼Œä¹˜ä»¥å“ªä¸ªå‚æ•°ä»¥åŠæœ€å¤§æˆæœ¬ï¼Œè€Œgraphql-cost-analysiså°†ä¸ºæ‚¨å®Œæˆå‰©ä¸‹çš„å·¥ä½œã€‚")]),t._v(" "),a("p",[t._v("æˆ‘é€šè¿‡Apollo Engineå…¬å¼€çš„æ€§èƒ½è·Ÿè¸ªæ•°æ®ç¡®å®šäº†æŸäº›è§£æå™¨çš„å¤æ‚ç¨‹åº¦ã€‚\næˆ‘æµè§ˆäº†æ•´ä¸ªæ¨¡å¼ï¼Œå¹¶æ ¹æ®p99æœåŠ¡æ—¶é—´åˆ†é…äº†ä¸€ä¸ªå€¼ã€‚ç„¶åæˆ‘ä»¬æŸ¥çœ‹äº†å®¢æˆ·ç«¯ä¸Šçš„æ‰€æœ‰æŸ¥è¯¢ï¼Œæ‰¾å‡ºæœ€æ˜‚è´µçš„æŸ¥è¯¢ï¼Œå¾—åˆ°~500ä¸ªå¤æ‚ç‚¹ã€‚ä¸ºäº†ç»™æˆ‘ä»¬ä¸€äº›æœªæ¥çš„ä½™åœ°ï¼Œæˆ‘ä»¬å°†æœ€å¤§å¤æ‚åº¦è®¾ç½®ä¸º750ã€‚")]),t._v(" "),a("p",[t._v("è¿è¡Œä¸Šé¢çš„evilQueryï¼Œç°åœ¨æˆ‘ä»¬å·²ç»æ·»åŠ äº†graphql-cost-analysisï¼Œæˆ‘æ”¶åˆ°ä¸€æ¡é”™è¯¯æ¶ˆæ¯ï¼Œå‘Šè¯‰æˆ‘â€œGraphQLæŸ¥è¯¢è¶…å‡ºæœ€å¤§å¤æ‚åº¦ï¼Œè¯·åˆ é™¤ä¸€äº›åµŒå¥—æˆ–å­—æ®µï¼Œç„¶åå†è¯•ä¸€æ¬¡ã€‚ï¼ˆæœ€å¤§å€¼ï¼š750ï¼Œå®é™…å€¼ï¼š1010319ï¼‰â€œ")]),t._v(" "),a("p",[t._v("100ä¸‡å¤æ‚ç‚¹ï¼Ÿæ‹’ç»ï¼")]),t._v(" "),a("h2",{attrs:{id:"æ€»ç»“"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#æ€»ç»“"}},[t._v("#")]),t._v(" æ€»ç»“")]),t._v(" "),a("p",[t._v("æ€»è€Œè¨€ä¹‹ï¼Œæˆ‘å»ºè®®ä½¿ç”¨æŸ¥è¯¢æ·±åº¦é™åˆ¶å’ŒæŸ¥è¯¢æ•°é‡é™åˆ¶æ¥ä¸ºä»»ä½•GraphQL APIæ¥åšæœ€åŸºæœ¬çš„é˜²æŠ¤â€”â€”å®ƒä»¬æ˜“äºå®ç°å¹¶ä¸”å…·æœ‰è¶³å¤Ÿçš„å®‰å…¨æ€§ã€‚\næ ¹æ®æ‚¨çš„ç‰¹å®šå®‰å…¨è¦æ±‚å’Œæ¶æ„ï¼Œæ‚¨å¯èƒ½è¿˜éœ€è¦è°ƒæŸ¥æŸ¥è¯¢æˆæœ¬åˆ†æã€‚\nè™½ç„¶å®ƒæ¯”å…¶ä»–å·¥å…·æ›´å¤šçš„å·¥ä½œï¼Œä½†å®ƒç¡®å®æä¾›äº†é˜²å¾¡æ¶æ„è¡Œä¸ºè€…çš„å…¨é¢è¦†ç›–ã€‚")])])}),[],!1,null,null,null);s.default=r.exports}}]);